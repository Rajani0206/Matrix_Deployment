# This workflow will build a package using Maven and then publish it to GitHub packages when a release is created.
# For more information see: https://github.com/actions/setup-java/blob/main/docs/advanced-usage.md#apache-maven-with-a-settings-path

name: Build, Deploy, and Upload Artifacts.

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: [self-hosted, staging]
    - name: Configure Maven settings
      run: |
          mkdir -p ~/.m2
          echo "<settings>
                  <servers>
                    <server>
                      <id>hello-world-matrix</id>
                      <username>${{ secrets.JFROG_USERNAME }}</username>
                      <password>${{ secrets.JFROG_API_KEY }}</password>
                    </server>
                  </servers>
                </settings>" > ~/.m2/settings.xml   
        
    - name: Build with Maven
      run: mvn clean deploy
